# DFINITY
[![Build Status](https://jenkins.london.dfinity.build/job/chirp/badge/icon)](https://jenkins.london.dfinity.build/job/chirp)

> A general purpose computing platform.

## Build
Containers run as uid:gid 1000:1000. To change this, edit the Dockerfile before
running the commands below.
```bash
docker build -t dfinity/dfinity .
docker run -it -p 4000:4000 -p 4001:4001 -v `pwd`:/workspace dfinity/dfinity
make -j$(nproc)
stack build
```

## Testnet
Follow the instructions above to build the latest binary.

Note the IP address assigned by your Docker NAT.
```bash
ip addr | grep -oE 'inet \b([0-9]{1,3}\.){3}[0-9]{1,3}\b'
```

Run the binary you just built. This will be your seed node.
```bash
stack exec dfinity -- --disable-monitor
```

In another tab, get the addresses of your seed node.
```bash
curl -s http://127.0.0.1:4001/addresses | python -m json.tool
```

Start a second node.
```bash
docker run -it -p 4002:4002 -p 4003:4003 -v `pwd`:/workspace dfinity/dfinity
stack exec dfinity -- \
  --disable-monitor \
  --p2p-port=4002 \
  --register-host=172.17.0.2 \
  --register-port=4001 \
  --seed-nodes=/ip4/172.17.0.2/tcp/4000/ipfs/QmfSwcgf4i288ZRqKpzjm2J5aBg1ZD3yL9EDwt8Ky57xZd \
  --ui-port=4003
```

In another tab, start a third node.
```bash
docker run -it -p 4004:4004 -p 4005:4005 -v `pwd`:/workspace dfinity/dfinity
stack exec dfinity -- \
  --disable-monitor \
  --p2p-port=4004 \
  --register-host=172.17.0.2 \
  --register-port=4001 \
  --seed-nodes=/ip4/172.17.0.2/tcp/4000/ipfs/QmfSwcgf4i288ZRqKpzjm2J5aBg1ZD3yL9EDwt8Ky57xZd \
  --ui-port=4005
```

In another tab, subscribe to message events.
```bash
curl http://127.0.0.1:4005/messages
```

In another tab, post a message event.
```bash
curl -X POST -d '{"msgSig":"MEQCIExMUSBRnOeB44p2ZHITEMLp995EJizrJTWW1rg/u3fhAiBmSQyOTON0VC8MfUh1oyUar3MMwScuOHaA9Nl0pd1ajQ==","msgBytes":"AAAAAA9UaGlzIGlzIGEgdGVzdC4AAAAA","msgPubKey":"AmI0cbhPHxXEFxvcczS17EC+OMEO5egz2XYRBiSRha2k"}' http://127.0.0.1:4003/message
```

Switch back to your last tab to verify that the message was received.
